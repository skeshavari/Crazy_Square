<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Krazy Kruispunt</title>
    <script src="../blockly/blockly_compressed.js"></script>
    <script src="../blockly/blocks_compressed.js"></script>
	<script src="../blockly/javascript_compressed.js"></script>
    <script src="../blockly/msg/js/en.js"></script>
	<!-- Game engine: -->
	<script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>
	<script src="car.js"></script>
	<script src="crossroad.js"></script>
	<script src="trafficlight.js"></script>
	<script src="utilities.js"></script>
	
    <link rel="stylesheet" href="Krazy Kruispunt.css">
</head>
<body>
  <p>
    <button onclick="showCode()">Show JavaScript</button>
	<button onclick="displayCode()">Display JavaScript</button>
    <button onclick="runCode()">Run JavaScript</button>
  </p>
<div id="pageContainerDiv">
    <div id="gameScreenDiv">

		<script type="text/javascript">

			var game = new Phaser.Game(600, 600, Phaser.AUTO, gameScreenDiv, { preload: preload, create: create, update: update });
			var red = 0xFF0000, yellow = 0xFFFF00, green = 0x00FF00;

			function preload() {
				game.load.image('car', 'images/car.png');
			}

			var crossroad;
			var car;
			var trafficlight;

			function create() {
				crossroad = new Crossroad(game);
				trafficlight = new Trafficlight(red, gridToScreenX(4), gridToScreenY(4));
				car = new Car(game, gridToScreenX(0), gridToScreenY(1));

			}

			function update() {

			}

		</script>

	</div>
    <div id="blocklyDiv"></div>
</div>

<div id="toolBoxInsertsHere">
	
  <xml id="toolbox" style="display: none">
	<category name="Loops">
		<block type="if_else"></block>
		<block type="do_for_x_seconds">
			<field name="seconds">0</field>
		</block>
		<block type="repeat_until"></block>
	</category>
	<category name="Logic">
		<block type="and_or">
			<field name="andOr">&amp;&amp;</field>
		</block>
		<block type="checktrafficlight">
			<field name="LightIdentifier">TOP</field>
			<field name="LightValue">RED</field>
		</block>
		<block type="checktrafficlightcar">
			<field name="LightIdentifier">TOP</field>
			<field name="LightIdentifier">TOP</field>
		</block>
		<block type="gameisover"></block>
	</category>
	<category name="Alter">
		<block type="settrafficlight">
			<field name="LightIdentifier">TOP</field>
			<field name="LightValue">RED</field>
		</block>
	</category> 
</xml>

  <xml id="startBlocks" style="display: none">
  

  </xml>

</div>
	<script src="BlocklyGenStubs.js"></script>
	<script src="BlocklyBlockDefs.js"></script>
	<script src="workspace.js"></script>
	<script>
		function showCode() {
		  // Generate JavaScript code and display it.
		  Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
		  var code = Blockly.JavaScript.workspaceToCode(workspace);
			alert(code);
		}
				function setLabelToCode(code){
			var s = document.getElementById('gamescreenlabel').innerHTML = code;
		}
		
		function displayCode() {
		  // Generate JavaScript code and display it.
		  Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
		  var code = Blockly.JavaScript.workspaceToCode(workspace);
			setLabelToCode(code); 	
		}
		
		function runCode() {
		  // Generate JavaScript code and run it.
		  window.LoopTrap = 1000;
		  Blockly.JavaScript.INFINITE_LOOP_TRAP =
			  'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
		  var code = Blockly.JavaScript.workspaceToCode(workspace);
		  Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
		  try {
			eval(code);
		  } catch (e) {
			alert(e);
		  }
		}
	</script>
</body>
</html>
